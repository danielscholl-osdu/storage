run-test-pages:
  stage: build
  image: python:latest
  script:
    - cd docs
    - pip install mkdocs-material
    - pip install mkdocs-git-revision-date-plugin
    - mkdocs build --site-dir ../test
  allow_failure: true
  artifacts:
    paths:
    - test
  when: manual

pages:
  stage: publish
  image: python:latest
  needs:
    - job: generate-allure-report
      artifacts: true
      optional: true
  script: |
    cd docs
    pip install --default-timeout=1000 mkdocs-material mkdocs-git-revision-date-plugin
    mkdocs build --site-dir ../public
    cd ..

    mkdir -p public/allure

    if [ -d "tmp/allure" ]; then
      for dir in tmp/allure/*; do
        if [ -d "$dir" ]; then
          module=$(basename "$dir")
          echo "Publishing Allure report for module: $module"
          mkdir -p "public/allure/$module"
          cp -r "$dir/"* "public/allure/$module/"
        fi
      done
    else
      echo "No Allure reports found â€” skipping."
    fi
  artifacts:
    paths:
      - public
